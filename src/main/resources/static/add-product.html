<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Product</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    form {
      max-width: 500px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    img {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<h1>Add New Product</h1>

<!-- 商品新增表单 -->
<form id="productForm">
  <label for="name">Product Name:</label>
  <input type="text" id="name" name="name" placeholder="Enter product name" required>

  <label for="description">Description:</label>
  <input type="text" id="description" name="description" placeholder="Enter product description" required>

  <label for="price">Price:</label>
  <input type="number" id="price" name="price" placeholder="Enter product price" step="0.01" required>

  <label for="stock">Stock:</label>
  <input type="number" id="stock" name="stock" placeholder="Enter product stock" required>

  <label for="categoryId">Category ID:</label>
  <input type="number" id="categoryId" name="categoryId" placeholder="Enter category ID" required>

  <label for="image">Select Product Image:</label>
  <input type="file" id="image" name="image" accept="image/*" required>

  <!-- 显示图片预览 -->
  <img id="preview" src="#" alt="Image Preview" style="display: none;">

  <button type="button" onclick="addProduct()">Add Product</button>
</form>

<!-- 提示消息 -->
<div id="status"></div>

<script>
  // 文件选择后显示预览
  document.getElementById("image").addEventListener("change", function (event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById("preview");
        preview.src = e.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  });

  // 上传商品信息和图片
  async function addProduct() {
    const formData = new FormData();

    // 获取表单数据
    formData.append("name", document.getElementById("name").value);
    formData.append("description", document.getElementById("description").value);
    formData.append("price", document.getElementById("price").value);
    formData.append("stock", document.getElementById("stock").value);
    formData.append("categoryId", document.getElementById("categoryId").value);

    // 获取文件数据
    const imageFile = document.getElementById("image").files[0];
    if (!imageFile) {
      alert("Please select an image.");
      return;
    }
    formData.append("image", imageFile);

    try {
      const response = await fetch("http://localhost:8080/products", {
        method: "POST",
        body: formData,
      });

      if (response.ok) {
        const result = await response.json();
        document.getElementById("status").innerHTML = `<p style="color: green;">Product added successfully! Product ID: ${result.id}</p>`;
        document.getElementById("productForm").reset();
        document.getElementById("preview").style.display = "none";
      } else {
        const error = await response.json();
        document.getElementById("status").innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
      }
    } catch (error) {
      document.getElementById("status").innerHTML = `<p style="color: red;">Network error: ${error.message}</p>`;
    }
  }
</script>
</body>
</html>
